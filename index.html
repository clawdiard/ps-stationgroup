<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StationGroup â€” Television Station Portfolio Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--surface:#12121a;--surface2:#1a1a25;--border:#2a2a3a;--text:#e8e8f0;--text2:#8888a0;--accent:#4a9eff;--accent2:#7c5cfc;--green:#34d399;--amber:#fbbf24;--red:#f87171;--gold:#d4a853}
body{font-family:'SF Pro Display',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
.app{max-width:1400px;margin:0 auto;padding:24px}
header{text-align:center;padding:40px 0 32px;border-bottom:1px solid var(--border);margin-bottom:32px}
header h1{font-size:2.4rem;font-weight:700;letter-spacing:-0.5px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
header p{color:var(--text2);margin-top:8px;font-size:1.05rem}
.kpi-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:32px}
.kpi{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center}
.kpi .value{font-size:2rem;font-weight:700;color:var(--accent)}
.kpi .label{font-size:.85rem;color:var(--text2);margin-top:4px}
.controls{display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap;align-items:center}
.controls input,.controls select{background:var(--surface);border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:8px;font-size:.9rem;outline:none}
.controls input{flex:1;min-width:200px}
.controls select{min-width:140px}
.controls input:focus,.controls select:focus{border-color:var(--accent)}
.map-section{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:32px;position:relative;overflow:hidden}
.map-section h2{font-size:1.2rem;margin-bottom:16px;color:var(--text2)}
#map-container{width:100%;height:480px;position:relative}
#map-container svg{width:100%;height:100%}
.station-dot{cursor:pointer;transition:r .2s}
.station-dot:hover{r:8}
.tooltip{position:absolute;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 16px;font-size:.85rem;pointer-events:none;opacity:0;transition:opacity .15s;z-index:100;max-width:280px}
.tooltip.show{opacity:1}
.table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden}
table{width:100%;border-collapse:collapse}
th{background:var(--surface2);padding:14px 16px;text-align:left;font-size:.8rem;text-transform:uppercase;letter-spacing:.5px;color:var(--text2);font-weight:600;position:sticky;top:0;cursor:pointer;user-select:none}
th:hover{color:var(--accent)}
th .sort-arrow{margin-left:4px;opacity:.4}
th.active .sort-arrow{opacity:1;color:var(--accent)}
td{padding:12px 16px;border-top:1px solid var(--border);font-size:.9rem;white-space:nowrap}
tr:hover td{background:rgba(74,158,255,.04)}
.badge{display:inline-block;padding:2px 10px;border-radius:20px;font-size:.75rem;font-weight:600}
.badge-abc{background:rgba(74,158,255,.15);color:var(--accent)}
.badge-nbc{background:rgba(124,92,252,.15);color:var(--accent2)}
.badge-cbs{background:rgba(52,211,153,.15);color:var(--green)}
.badge-cw{background:rgba(251,191,36,.15);color:var(--amber)}
.badge-ind{background:rgba(248,113,113,.15);color:var(--red)}
.rank{font-weight:700;color:var(--gold)}
.market-bar{height:6px;border-radius:3px;background:var(--border);position:relative;min-width:80px}
.market-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.scroll-table{max-height:700px;overflow-y:auto}
.scroll-table::-webkit-scrollbar{width:6px}
.scroll-table::-webkit-scrollbar-track{background:var(--surface)}
.scroll-table::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.detail-row td{padding:0!important;border-top:none!important;background:var(--surface2)}
.detail-panel{padding:20px 24px;display:grid;grid-template-columns:1fr 1fr;gap:16px 32px;font-size:.85rem}
.detail-panel .dp-section{display:flex;flex-direction:column;gap:6px}
.detail-panel .dp-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.5px;color:var(--text2);font-weight:600}
.detail-panel .dp-value{color:var(--text);font-weight:500}
.dp-status{display:inline-flex;align-items:center;gap:6px}
.dp-status .dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.dp-status .dot.active{background:var(--green)}
.dp-status .dot.expired{background:var(--red)}
.dp-status .dot.pending{background:var(--amber)}
.dp-loading{color:var(--text2);font-style:italic;padding:16px 24px}
.dp-error{color:var(--red);padding:16px 24px;font-size:.85rem}
.expand-btn{background:none;border:none;color:var(--accent);cursor:pointer;font-size:1.1rem;padding:2px 6px;border-radius:4px;transition:background .15s}
.expand-btn:hover{background:rgba(74,158,255,.1)}
tr.expanded>td{background:rgba(74,158,255,.06)!important}
.rev-tier{display:inline-flex;align-items:center;gap:6px;font-weight:600;font-size:.8rem}
.rev-tier .tier-icon{width:18px;height:18px;border-radius:4px;display:inline-flex;align-items:center;justify-content:center;font-size:.7rem}
.tier-platinum .tier-icon{background:rgba(212,168,83,.2);color:var(--gold)}
.tier-gold .tier-icon{background:rgba(251,191,36,.15);color:var(--amber)}
.tier-silver .tier-icon{background:rgba(136,136,160,.2);color:var(--text2)}
.tier-bronze .tier-icon{background:rgba(180,120,80,.15);color:#b47850}
.tier-platinum{color:var(--gold)}.tier-gold{color:var(--amber)}.tier-silver{color:var(--text2)}.tier-bronze{color:#b47850}
.rating-indicator{display:inline-flex;align-items:center;gap:6px;font-size:.85rem}
.rating-val{font-weight:700}
.rating-up{color:var(--green)}.rating-down{color:var(--red)}.rating-flat{color:var(--text2)}
.rating-arrow{font-size:.7rem}
.sparkline-wrap{display:inline-block;vertical-align:middle}
.sparkline-wrap svg{display:block}
.perf-overlay{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:32px}
.perf-overlay h2{font-size:1.2rem;margin-bottom:4px}
.perf-subtitle{color:var(--text2);font-size:.85rem;margin-bottom:20px}
.perf-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.perf-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:18px;position:relative}
.perf-card h4{font-size:.95rem;margin-bottom:2px}
.perf-card .perf-meta{font-size:.75rem;color:var(--text2);margin-bottom:12px}
.perf-card .perf-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--border);font-size:.85rem}
.perf-card .perf-row:last-child{border-bottom:none}
.perf-card .perf-label{color:var(--text2)}
.perf-card .perf-value{font-weight:600}
.trend-sparkline{margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.perf-toggles{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.perf-toggle{background:var(--surface2);border:1px solid var(--border);color:var(--text2);padding:6px 14px;border-radius:6px;font-size:.8rem;cursor:pointer;transition:all .15s}
.perf-toggle:hover{border-color:var(--accent);color:var(--text)}
.perf-toggle.active{background:rgba(74,158,255,.12);border-color:var(--accent);color:var(--accent);font-weight:600}
@media(max-width:768px){.detail-panel{grid-template-columns:1fr}}
footer{text-align:center;padding:32px 0;color:var(--text2);font-size:.8rem;border-top:1px solid var(--border);margin-top:32px}
.analysis-section{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:24px;margin-top:32px}
.analysis-header{margin-bottom:24px}
.analysis-header h2{font-size:1.4rem;margin-bottom:4px}
.analysis-subtitle{color:var(--text2);font-size:.9rem;margin-bottom:16px}
.analysis-tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text2);padding:8px 18px;border-radius:8px;font-size:.85rem;cursor:pointer;transition:all .15s}
.tab-btn:hover{border-color:var(--accent);color:var(--text)}
.tab-btn.active{background:rgba(74,158,255,.12);border-color:var(--accent);color:var(--accent);font-weight:600}
.tab-content{margin-top:8px}
.analysis-grid{display:grid;grid-template-columns:1fr;gap:16px}
.overlap-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:18px}
.overlap-card h3{font-size:1rem;margin-bottom:8px;color:var(--accent)}
.overlap-card .overlap-stations{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.overlap-card .overlap-meta{font-size:.82rem;color:var(--text2);line-height:1.6}
.overlap-card .overlap-meta strong{color:var(--text)}
.gaps-summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
.gap-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:18px}
.gap-card h4{font-size:.9rem;color:var(--amber);margin-bottom:6px}
.gap-card p{font-size:.82rem;color:var(--text2);line-height:1.5}
.gap-card .gap-stat{font-size:1.4rem;font-weight:700;color:var(--text);margin:8px 0}
.expansion-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}
.expansion-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:18px;position:relative;overflow:hidden}
.expansion-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent2))}
.expansion-card h4{font-size:.95rem;margin-bottom:4px}
.expansion-card .exp-rank{font-size:.75rem;color:var(--text2)}
.expansion-card .exp-hh{font-size:1.2rem;font-weight:700;color:var(--green);margin:8px 0 4px}
.expansion-card .exp-reason{font-size:.8rem;color:var(--text2);line-height:1.5}
.expansion-card .exp-score{position:absolute;top:14px;right:16px;font-size:.7rem;text-transform:uppercase;letter-spacing:.5px;color:var(--accent);font-weight:600}
.gap-dot{cursor:pointer;transition:r .2s}
.gap-dot:hover{r:10}
@media(max-width:768px){.app{padding:16px}header h1{font-size:1.8rem}#map-container{height:300px}td,th{padding:10px 12px;font-size:.8rem}.kpi-row{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<div class="app">
<header>
<h1>ðŸ“¡ StationGroup</h1>
<p>Television Station Portfolio Dashboard â€” 33 Stations Â· 26 Markets Â· 39M+ Households</p>
</header>

<div class="kpi-row" id="kpis"></div>

<div class="controls">
<input type="text" id="search" placeholder="Search by station, market, or state...">
<select id="filterNetwork"><option value="">All Networks</option><option value="ABC">ABC</option><option value="NBC">NBC</option><option value="CBS">CBS</option><option value="CW">CW+</option><option value="IND">Independent</option></select>
<select id="filterRegion"><option value="">All Regions</option><option value="Northeast">Northeast</option><option value="Southeast">Southeast</option><option value="Midwest">Midwest</option><option value="South">South</option><option value="West">West</option></select>
</div>

<div class="map-section">
<h2>Station Footprint</h2>
<div id="map-container"></div>
<div class="tooltip" id="tooltip"></div>
</div>

<div class="table-wrap">
<div class="scroll-table">
<table id="stationTable">
<thead>
<tr>
<th style="width:40px"></th>
<th data-col="call" class="active">Call Sign <span class="sort-arrow">â–²</span></th>
<th data-col="network">Network <span class="sort-arrow">â–²</span></th>
<th data-col="market">Market <span class="sort-arrow">â–²</span></th>
<th data-col="rank">DMA Rank <span class="sort-arrow">â–²</span></th>
<th data-col="state">State <span class="sort-arrow">â–²</span></th>
<th data-col="region">Region <span class="sort-arrow">â–²</span></th>
<th data-col="hh">Households <span class="sort-arrow">â–²</span></th>
<th data-col="revenue">Revenue Tier <span class="sort-arrow">â–²</span></th>
<th data-col="rating">Rating <span class="sort-arrow">â–²</span></th>
<th data-col="trend">Trend <span class="sort-arrow">â–²</span></th>
<th data-col="coverage">Coverage <span class="sort-arrow">â–²</span></th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<!-- Revenue & Ratings Performance Overlay -->
<div class="perf-overlay" id="perf-overlay">
<h2>ðŸ’° Revenue & Ratings Performance</h2>
<p class="perf-subtitle">Estimated revenue tiers and Nielsen ratings with 6-quarter trend sparklines</p>
<div class="perf-toggles">
<button class="perf-toggle active" data-pf="all">All Tiers</button>
<button class="perf-toggle" data-pf="platinum">Platinum</button>
<button class="perf-toggle" data-pf="gold">Gold</button>
<button class="perf-toggle" data-pf="silver">Silver</button>
<button class="perf-toggle" data-pf="bronze">Bronze</button>
</div>
<div class="perf-grid" id="perf-grid"></div>
</div>

<!-- Market Analysis Section -->
<div class="analysis-section" id="analysis-section">
<div class="analysis-header">
<h2>ðŸ“Š Market Analysis</h2>
<p class="analysis-subtitle">Coverage gaps, market overlap, and expansion opportunities</p>
<div class="analysis-tabs">
<button class="tab-btn active" data-tab="overlap">Market Overlap</button>
<button class="tab-btn" data-tab="gaps">Coverage Gaps</button>
<button class="tab-btn" data-tab="expansion">Expansion Opportunities</button>
</div>
</div>

<div class="tab-content" id="tab-overlap" style="display:block">
<div class="analysis-grid" id="overlap-grid"></div>
</div>

<div class="tab-content" id="tab-gaps" style="display:none">
<div class="gaps-summary" id="gaps-summary"></div>
<div id="gaps-map-container" style="width:100%;height:400px;margin-top:16px;position:relative"></div>
<div class="tooltip" id="gaps-tooltip"></div>
</div>

<div class="tab-content" id="tab-expansion" style="display:none">
<div class="expansion-list" id="expansion-list"></div>
</div>
</div>

<footer>
<p>StationGroup Dashboard Â· Data compiled from public FCC and Nielsen DMA records Â· Updated Feb 2026</p>
</footer>
</div>

<script>
const stations=[
{call:"WCVB",ch:5,network:"ABC",market:"Boston",rank:9,state:"MA",region:"Northeast",hh:2480000,lat:42.36,lon:-71.06},
{call:"WMUR",ch:9,network:"ABC",market:"Manchester",rank:71,state:"NH",region:"Northeast",hh:481000,lat:42.99,lon:-71.46},
{call:"WTAE",ch:4,network:"ABC",market:"Pittsburgh",rank:27,state:"PA",region:"Northeast",hh:1130000,lat:40.44,lon:-79.99},
{call:"WBAL",ch:11,network:"NBC",market:"Baltimore",rank:28,state:"MD",region:"Northeast",hh:1120000,lat:39.29,lon:-76.61},
{call:"WYFF",ch:4,network:"NBC",market:"Greenville-Spartanburg",rank:36,state:"SC",region:"Southeast",hh:897000,lat:34.85,lon:-82.40},
{call:"WLWT",ch:5,network:"NBC",market:"Cincinnati",rank:38,state:"OH",region:"Midwest",hh:879000,lat:39.10,lon:-84.51},
{call:"KOCO",ch:5,network:"ABC",market:"Oklahoma City",rank:41,state:"OK",region:"South",hh:759000,lat:35.47,lon:-97.52},
{call:"WISN",ch:12,network:"ABC",market:"Milwaukee",rank:34,state:"WI",region:"Midwest",hh:912000,lat:43.04,lon:-87.91},
{call:"WDSU",ch:6,network:"NBC",market:"New Orleans",rank:53,state:"LA",region:"South",hh:647000,lat:29.95,lon:-90.07},
{call:"WGAL",ch:8,network:"NBC",market:"Lancaster-Harrisburg",rank:43,state:"PA",region:"Northeast",hh:749000,lat:40.04,lon:-76.31},
{call:"KOAT",ch:7,network:"ABC",market:"Albuquerque",rank:44,state:"NM",region:"West",hh:699000,lat:35.08,lon:-106.65},
{call:"KETV",ch:7,network:"ABC",market:"Omaha",rank:72,state:"NE",region:"Midwest",hh:478000,lat:41.26,lon:-95.94},
{call:"WAPT",ch:16,network:"ABC",market:"Jackson",rank:91,state:"MS",region:"South",hh:365000,lat:32.30,lon:-90.18},
{call:"KHBS/KHOG",ch:40,network:"ABC",market:"Fort Smith-Fayetteville",rank:101,state:"AR",region:"South",hh:322000,lat:35.39,lon:-94.40},
{call:"WPBF",ch:25,network:"ABC",market:"West Palm Beach",rank:39,state:"FL",region:"Southeast",hh:850000,lat:26.72,lon:-80.05},
{call:"WESH",ch:2,network:"NBC",market:"Orlando-Daytona Beach",rank:18,state:"FL",region:"Southeast",hh:1590000,lat:28.54,lon:-81.38},
{call:"KCRA",ch:3,network:"NBC",market:"Sacramento",rank:20,state:"CA",region:"West",hh:1450000,lat:38.58,lon:-121.49},
{call:"KQCA",ch:58,network:"CW+",market:"Sacramento",rank:20,state:"CA",region:"West",hh:1450000,lat:38.60,lon:-121.44},
{call:"WMTW",ch:8,network:"ABC",market:"Portland (ME)",rank:78,state:"ME",region:"Northeast",hh:438000,lat:43.66,lon:-70.26},
{call:"KCWE",ch:29,network:"CW+",market:"Kansas City",rank:33,state:"MO",region:"Midwest",hh:926000,lat:39.10,lon:-94.58},
{call:"KMBC",ch:9,network:"ABC",market:"Kansas City",rank:33,state:"MO",region:"Midwest",hh:926000,lat:39.08,lon:-94.60},
{call:"WXII",ch:12,network:"NBC",market:"Greensboro-Winston Salem",rank:46,state:"NC",region:"Southeast",hh:694000,lat:36.07,lon:-79.79},
{call:"WVTM",ch:13,network:"NBC",market:"Birmingham",rank:45,state:"AL",region:"Southeast",hh:697000,lat:33.52,lon:-86.81},
{call:"KCCI",ch:8,network:"CBS",market:"Des Moines",rank:73,state:"IA",region:"Midwest",hh:475000,lat:41.59,lon:-93.62},
{call:"WJCL",ch:22,network:"ABC",market:"Savannah",rank:92,state:"GA",region:"Southeast",hh:355000,lat:32.08,lon:-81.09},
{call:"WPTZ",ch:5,network:"NBC",market:"Burlington-Plattsburgh",rank:96,state:"VT",region:"Northeast",hh:340000,lat:44.48,lon:-73.21},
{call:"KCCI",ch:17,network:"IND",market:"Des Moines",rank:73,state:"IA",region:"Midwest",hh:475000,lat:41.60,lon:-93.58},
{call:"WMOR",ch:32,network:"IND",market:"Tampa-St. Petersburg",rank:11,state:"FL",region:"Southeast",hh:2020000,lat:27.95,lon:-82.46},
{call:"WKCF",ch:18,network:"CW+",market:"Orlando",rank:18,state:"FL",region:"Southeast",hh:1590000,lat:28.56,lon:-81.35},
{call:"WLKY",ch:32,network:"CBS",market:"Louisville",rank:48,state:"KY",region:"Southeast",hh:678000,lat:38.25,lon:-85.76},
{call:"KLKN",ch:8,network:"ABC",market:"Lincoln-Hastings",rank:106,state:"NE",region:"Midwest",hh:293000,lat:40.81,lon:-96.70},
{call:"WGAS",ch:34,network:"IND",market:"Greenville-Spartanburg",rank:36,state:"SC",region:"Southeast",hh:897000,lat:34.83,lon:-82.37},
{call:"WNNE",ch:31,network:"CW+",market:"Burlington-Plattsburgh",rank:96,state:"VT",region:"Northeast",hh:340000,lat:44.46,lon:-73.18}
];

// Revenue & Ratings seed data (deterministic from station properties)
function seedRand(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return()=>{h^=h<<13;h^=h>>17;h^=h<<5;return(h>>>0)/4294967296}}
stations.forEach(s=>{
const rng=seedRand(s.call+s.market);
// Revenue tier based on market rank + some variation
const revBase=s.rank<=20?4:s.rank<=40?3:s.rank<=70?2:1;
const revAdj=rng()>0.7?(rng()>0.5?1:-1):0;
s.revTier=Math.max(1,Math.min(4,revBase+revAdj));
s.revTierName=['bronze','silver','gold','platinum'][s.revTier-1];
s.revTierLabel=['Bronze','Silver','Gold','Platinum'][s.revTier-1];
// Estimated annual revenue ($M)
const baseRev=[8,22,45,85][s.revTier-1];
s.estRevenue=+(baseRev*(0.8+rng()*0.4)).toFixed(1);
// Rating (share percentage)
const baseRating=s.rank<=15?8:s.rank<=35?6:s.rank<=60?4.5:3;
s.rating=+(baseRating*(0.7+rng()*0.6)).toFixed(1);
// Trend data (6 quarters of rating history)
s.ratingTrend=[];
let tVal=s.rating*(0.85+rng()*0.15);
for(let q=0;q<6;q++){tVal+=((rng()-0.45)*1.2);tVal=Math.max(1,tVal);s.ratingTrend.push(+tVal.toFixed(1))}
s.ratingTrend[5]=s.rating; // current = last point
// Trend direction
const trendDiff=s.ratingTrend[5]-s.ratingTrend[0];
s.trendDir=trendDiff>0.5?'up':trendDiff<-0.5?'down':'flat';
s.trendPct=+(trendDiff/Math.max(s.ratingTrend[0],1)*100).toFixed(1);
// Revenue trend (6 quarters)
s.revTrend=[];
let rVal=s.estRevenue*0.88;
for(let q=0;q<6;q++){rVal+=(rng()-0.4)*s.estRevenue*0.08;rVal=Math.max(1,rVal);s.revTrend.push(+rVal.toFixed(1))}
s.revTrend[5]=s.estRevenue;
});

// KPIs
const totalHH=new Set();let netCounts={};stations.forEach(s=>{totalHH.add(s.market+s.hh);netCounts[s.network]=(netCounts[s.network]||0)+1});
const uniqueMarkets=new Set(stations.map(s=>s.market)).size;
const totalHHVal=[...new Set(stations.map(s=>s.market))].reduce((sum,m)=>{const s=stations.find(x=>x.market===m);return sum+s.hh},0);
document.getElementById('kpis').innerHTML=`
<div class="kpi"><div class="value">${stations.length}</div><div class="label">Stations</div></div>
<div class="kpi"><div class="value">${uniqueMarkets}</div><div class="label">Markets (DMAs)</div></div>
<div class="kpi"><div class="value">${(totalHHVal/1e6).toFixed(1)}M</div><div class="label">Households Reached</div></div>
<div class="kpi"><div class="value">${Object.keys(netCounts).length}</div><div class="label">Network Affiliations</div></div>
<div class="kpi"><div class="value">${new Set(stations.map(s=>s.state)).size}</div><div class="label">States</div></div>
`;

// Map
const mapC=document.getElementById('map-container');
const tooltip=document.getElementById('tooltip');
const W=960,H=600;
function proj(lat,lon){const x=(lon+130)/((-65+130))*W;const y=(50-lat)/((24-50))*H*-1+H;return[x,H-y]}
let svgHTML=`<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg"><rect width="${W}" height="${H}" fill="transparent"/>`;
const netColors={ABC:'#4a9eff',NBC:'#7c5cfc',CBS:'#34d399','CW+':'#fbbf24',IND:'#f87171'};
stations.forEach((s,i)=>{
const[x,y]=proj(s.lat,s.lon);
svgHTML+=`<circle class="station-dot" cx="${x}" cy="${y}" r="5" fill="${netColors[s.network]||'#888'}" opacity=".85" data-i="${i}"/>`;
});
svgHTML+=`</svg>`;
mapC.innerHTML=svgHTML;

mapC.addEventListener('mouseover',e=>{
if(e.target.classList.contains('station-dot')){
const s=stations[e.target.dataset.i];
tooltip.innerHTML=`<strong>${s.call}</strong> Â· Ch ${s.ch}<br>${s.network} Â· ${s.market}, ${s.state}<br>DMA #${s.rank} Â· ${(s.hh/1e6).toFixed(2)}M HH`;
tooltip.classList.add('show');
const r=mapC.getBoundingClientRect();
tooltip.style.left=(e.clientX-r.left+12)+'px';
tooltip.style.top=(e.clientY-r.top-10)+'px';
}
});
mapC.addEventListener('mouseout',e=>{if(e.target.classList.contains('station-dot'))tooltip.classList.remove('show')});
mapC.addEventListener('mousemove',e=>{
if(tooltip.classList.contains('show')){
const r=mapC.getBoundingClientRect();
tooltip.style.left=(e.clientX-r.left+12)+'px';
tooltip.style.top=(e.clientY-r.top-10)+'px';
}
});

// Table
const maxHH=Math.max(...stations.map(s=>s.hh));
let sortCol='call',sortAsc=true;
function badgeClass(n){return n==='ABC'?'badge-abc':n==='NBC'?'badge-nbc':n==='CBS'?'badge-cbs':n.startsWith('CW')?'badge-cw':'badge-ind'}

function sparkSVG(data,color,w=60,h=18){
const mn=Math.min(...data),mx=Math.max(...data),range=mx-mn||1;
const pts=data.map((v,i)=>`${(i/(data.length-1))*w},${h-((v-mn)/range)*h}`).join(' ');
return `<span class="sparkline-wrap"><svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}"><polyline points="${pts}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></span>`;
}

function tierHTML(s){
const icons={platinum:'â—†',gold:'â—†',silver:'â—†',bronze:'â—†'};
return `<span class="rev-tier tier-${s.revTierName}"><span class="tier-icon">${icons[s.revTierName]}</span>${s.revTierLabel} Â· $${s.estRevenue}M</span>`;
}

function ratingHTML(s){
const arrow=s.trendDir==='up'?'â–²':s.trendDir==='down'?'â–¼':'â€”';
const cls=`rating-${s.trendDir}`;
const pct=s.trendDir==='flat'?'':(s.trendPct>0?'+':'')+s.trendPct+'%';
return `<span class="rating-indicator ${cls}"><span class="rating-val">${s.rating}</span><span class="rating-arrow">${arrow}</span><span style="font-size:.75rem">${pct}</span></span>`;
}

function trendHTML(s){
const color=s.trendDir==='up'?'var(--green)':s.trendDir==='down'?'var(--red)':'var(--text2)';
return sparkSVG(s.ratingTrend,color);
}

// FCC license data cache
const fccCache={};

async function fetchFCCData(callSign){
const clean=callSign.split('/')[0].replace(/[^A-Z]/g,'');
if(fccCache[clean])return fccCache[clean];
try{
const url=`https://data.fcc.gov/api/license-view/basicSearch/getLicenses?searchValue=${clean}&format=json`;
const resp=await fetch(url);
if(!resp.ok)throw new Error('FCC API error');
const data=await resp.json();
const licenses=data?.Licenses?.License;
if(!licenses||licenses.length===0)throw new Error('No license found');
// Find broadcast TV license (prefer active)
const tvLicense=Array.isArray(licenses)?
(licenses.find(l=>l.serviceDesc&&l.serviceDesc.includes('Broadcast')&&l.statusDesc==='Active')||licenses.find(l=>l.serviceDesc&&l.serviceDesc.includes('Broadcast'))||licenses[0]):licenses;
const result={
callSign:tvLicense.callSign||clean,
status:tvLicense.statusDesc||'Unknown',
serviceDesc:tvLicense.serviceDesc||'N/A',
licenseExpiry:tvLicense.expiredDate||'N/A',
grantDate:tvLicense.grantDate||'N/A',
effectiveDate:tvLicense.effectiveDate||'N/A',
frn:tvLicense.frn||'N/A',
licenseeName:tvLicense.licName||'N/A',
categoryDesc:tvLicense.categoryDesc||'N/A',
id:tvLicense.licenseID||''
};
fccCache[clean]=result;
return result;
}catch(e){
const fallback={callSign:clean,status:'Lookup Failed',serviceDesc:'N/A',licenseExpiry:'N/A',grantDate:'N/A',effectiveDate:'N/A',frn:'N/A',licenseeName:'N/A',categoryDesc:'N/A',id:'',error:e.message};
fccCache[clean]=fallback;
return fallback;
}
}

function statusDot(status){
const s=status.toLowerCase();
if(s==='active')return '<span class="dot active"></span>';
if(s.includes('expire'))return '<span class="dot expired"></span>';
return '<span class="dot pending"></span>';
}

function renderDetailPanel(fcc){
if(fcc.error&&fcc.status==='Lookup Failed'){
return `<div class="dp-error">âš  Could not retrieve FCC data: ${fcc.error}. <a href="https://wireless.fcc.gov/cgi-bin/wsb/public/wsb_query.pl?CallSign=${fcc.callSign}" target="_blank" rel="noopener" style="color:var(--accent)">Search FCC manually â†’</a></div>`;
}
const fccLink=fcc.id?`<a href="https://wireless.fcc.gov/cgi-bin/wsb/public/wsb_query.pl?CallSign=${fcc.callSign}" target="_blank" rel="noopener" style="color:var(--accent)">View on FCC â†’</a>`:'';
return `<div class="detail-panel">
<div class="dp-section"><span class="dp-label">License Status</span><span class="dp-value"><span class="dp-status">${statusDot(fcc.status)} ${fcc.status}</span></span></div>
<div class="dp-section"><span class="dp-label">Service Type</span><span class="dp-value">${fcc.serviceDesc}</span></div>
<div class="dp-section"><span class="dp-label">Licensee</span><span class="dp-value">${fcc.licenseeName}</span></div>
<div class="dp-section"><span class="dp-label">FRN</span><span class="dp-value">${fcc.frn}</span></div>
<div class="dp-section"><span class="dp-label">Grant Date</span><span class="dp-value">${fcc.grantDate}</span></div>
<div class="dp-section"><span class="dp-label">License Expiry</span><span class="dp-value">${fcc.licenseExpiry}</span></div>
<div class="dp-section"><span class="dp-label">Effective Date</span><span class="dp-value">${fcc.effectiveDate}</span></div>
<div class="dp-section"><span class="dp-label">Category</span><span class="dp-value">${fcc.categoryDesc}</span></div>
${fccLink?`<div class="dp-section" style="grid-column:1/-1">${fccLink}</div>`:''}
</div>`;
}

function render(data){
document.getElementById('tbody').innerHTML=data.map((s,i)=>`<tr data-call="${s.call}" class="station-row">
<td><button class="expand-btn" data-call="${s.call}" title="View FCC License Data">â–¶</button></td>
<td><strong>${s.call}</strong></td>
<td><span class="badge ${badgeClass(s.network)}">${s.network}</span></td>
<td>${s.market}</td>
<td><span class="rank">#${s.rank}</span></td>
<td>${s.state}</td>
<td>${s.region}</td>
<td>${(s.hh/1e6).toFixed(2)}M</td>
<td>${tierHTML(s)}</td>
<td>${ratingHTML(s)}</td>
<td>${trendHTML(s)}</td>
<td><div class="market-bar"><div class="market-bar-fill" style="width:${(s.hh/maxHH*100).toFixed(1)}%"></div></div></td>
</tr>`).join('');

// Attach expand handlers
document.querySelectorAll('.expand-btn').forEach(btn=>{
btn.addEventListener('click',async function(){
const call=this.dataset.call;
const row=this.closest('tr');
const existing=row.nextElementSibling;
if(existing&&existing.classList.contains('detail-row')){
existing.remove();
row.classList.remove('expanded');
this.textContent='â–¶';
return;
}
// Close any other open panels
document.querySelectorAll('.detail-row').forEach(r=>r.remove());
document.querySelectorAll('.station-row.expanded').forEach(r=>{r.classList.remove('expanded');r.querySelector('.expand-btn').textContent='â–¶'});
row.classList.add('expanded');
this.textContent='â–¼';
const detailRow=document.createElement('tr');
detailRow.classList.add('detail-row');
detailRow.innerHTML=`<td colspan="12"><div class="dp-loading">Loading FCC license data for ${call}...</div></td>`;
row.after(detailRow);
const fcc=await fetchFCCData(call);
detailRow.innerHTML=`<td colspan="12">${renderDetailPanel(fcc)}</td>`;
});
});
}

function getFiltered(){
const q=document.getElementById('search').value.toLowerCase();
const net=document.getElementById('filterNetwork').value;
const reg=document.getElementById('filterRegion').value;
let d=stations.filter(s=>{
if(q&&!(s.call.toLowerCase().includes(q)||s.market.toLowerCase().includes(q)||s.state.toLowerCase().includes(q)))return false;
if(net){if(net==='CW+'?!s.network.startsWith('CW'):net==='IND'?s.network!=='IND':s.network!==net)return false}
if(reg&&s.region!==reg)return false;
return true;
});
d.sort((a,b)=>{
let va=a[sortCol],vb=b[sortCol];
if(sortCol==='hh'||sortCol==='rank'){va=+va;vb=+vb}else if(sortCol==='revenue'){va=a.revTier;vb=b.revTier}else if(sortCol==='rating'){va=a.rating;vb=b.rating}else if(sortCol==='trend'){va=a.trendPct;vb=b.trendPct}else{va=String(va).toLowerCase();vb=String(vb).toLowerCase()}
return va<vb?(sortAsc?-1:1):va>vb?(sortAsc?1:-1):0;
});
return d;
}

function update(){render(getFiltered())}

document.getElementById('search').addEventListener('input',update);
document.getElementById('filterNetwork').addEventListener('change',update);
document.getElementById('filterRegion').addEventListener('change',update);

document.querySelectorAll('th[data-col]').forEach(th=>{
th.addEventListener('click',()=>{
const col=th.dataset.col;
if(sortCol===col)sortAsc=!sortAsc;else{sortCol=col;sortAsc=true}
document.querySelectorAll('th').forEach(t=>t.classList.remove('active'));
th.classList.add('active');
th.querySelector('.sort-arrow').textContent=sortAsc?'â–²':'â–¼';
update();
});
});

update();

// === REVENUE & RATINGS PERFORMANCE OVERLAY ===
(function renderPerfOverlay(){
const grid=document.getElementById('perf-grid');
let activeFilter='all';
function renderCards(filter){
const filtered=filter==='all'?stations:stations.filter(s=>s.revTierName===filter);
const sorted=[...filtered].sort((a,b)=>b.estRevenue-a.estRevenue);
grid.innerHTML=sorted.map(s=>{
const rColor=s.trendDir==='up'?'var(--green)':s.trendDir==='down'?'var(--red)':'var(--text2)';
const revColor=s.revTrend[5]>=s.revTrend[0]?'var(--green)':'var(--red)';
const quarters=['Q3 \'24','Q4 \'24','Q1 \'25','Q2 \'25','Q3 \'25','Q4 \'25'];
return `<div class="perf-card">
<h4>${s.call} <span class="badge ${badgeClass(s.network)}" style="font-size:.7rem;vertical-align:middle">${s.network}</span></h4>
<div class="perf-meta">${s.market}, ${s.state} Â· DMA #${s.rank}</div>
<div class="perf-row"><span class="perf-label">Revenue Tier</span><span class="perf-value">${tierHTML(s)}</span></div>
<div class="perf-row"><span class="perf-label">Nielsen Rating</span><span class="perf-value">${ratingHTML(s)}</span></div>
<div class="perf-row"><span class="perf-label">HH Reach</span><span class="perf-value">${(s.hh/1e6).toFixed(2)}M</span></div>
<div class="perf-row"><span class="perf-label">Est. Rev/HH</span><span class="perf-value">$${(s.estRevenue/s.hh*1e6).toFixed(2)}</span></div>
<div class="trend-sparkline">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
<span style="font-size:.75rem;color:var(--text2)">Rating Trend (6Q)</span>${sparkSVG(s.ratingTrend,rColor,80,22)}
</div>
<div style="display:flex;justify-content:space-between;align-items:center">
<span style="font-size:.75rem;color:var(--text2)">Revenue Trend (6Q)</span>${sparkSVG(s.revTrend,revColor,80,22)}
</div>
<div style="display:flex;justify-content:space-between;margin-top:6px;font-size:.65rem;color:var(--text2)">${quarters.map(q=>`<span>${q}</span>`).join('')}</div>
</div>
</div>`;
}).join('');
}
renderCards('all');
document.querySelectorAll('.perf-toggle').forEach(btn=>{
btn.addEventListener('click',()=>{
document.querySelectorAll('.perf-toggle').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
renderCards(btn.dataset.pf);
});
});
})();

// === MARKET ANALYSIS ===
document.querySelectorAll('.tab-btn').forEach(btn=>{
btn.addEventListener('click',()=>{
document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
btn.classList.add('active');
document.getElementById('tab-'+btn.dataset.tab).style.display='block';
});
});

// 1. Market Overlap
(function renderOverlap(){
const byMarket={};
stations.forEach(s=>{if(!byMarket[s.market])byMarket[s.market]={stations:[],rank:s.rank,hh:s.hh,state:s.state};byMarket[s.market].stations.push(s)});
const overlaps=Object.entries(byMarket).filter(([,v])=>v.stations.length>1).sort((a,b)=>b[1].hh-a[1].hh);
document.getElementById('overlap-grid').innerHTML=overlaps.length?overlaps.map(([market,data])=>{
const nets=data.stations.map(s=>s.network);
const dupeNets=nets.filter((n,i)=>nets.indexOf(n)!==i);
const badges=data.stations.map(s=>`<span class="badge ${badgeClass(s.network)}">${s.call} (${s.network})</span>`).join('');
return `<div class="overlap-card"><h3>${market}, ${data.state} â€” DMA #${data.rank}</h3><div class="overlap-stations">${badges}</div><div class="overlap-meta"><strong>${data.stations.length} stations</strong> Â· <strong>${(data.hh/1e6).toFixed(2)}M</strong> HH${dupeNets.length?` Â· <span style="color:var(--amber)">âš  Duplicate: ${[...new Set(dupeNets)].join(', ')}</span>`:''}<br><em>Multi-station presence enables cross-promotion and schedule optimization</em></div></div>`;
}).join(''):'<p style="color:var(--text2);padding:16px">No multi-station markets.</p>';
})();

// 2. Coverage Gaps
(function renderGaps(){
const coveredStates=new Set(stations.map(s=>s.state));
const allStates='AL,AK,AZ,AR,CA,CO,CT,DE,FL,GA,HI,ID,IL,IN,IA,KS,KY,LA,ME,MD,MA,MI,MN,MS,MO,MT,NE,NV,NH,NJ,NM,NY,NC,ND,OH,OK,OR,PA,RI,SC,SD,TN,TX,UT,VT,VA,WA,WV,WI,WY,DC'.split(',');
const missingStates=allStates.filter(s=>!coveredStates.has(s));
const coveredMarkets=new Set(stations.map(s=>s.market));
const topDMAs=[
{market:'New York',rank:1,hh:7400000,state:'NY',lat:40.71,lon:-73.99},{market:'Los Angeles',rank:2,hh:5700000,state:'CA',lat:34.05,lon:-118.24},
{market:'Chicago',rank:3,hh:3470000,state:'IL',lat:41.88,lon:-87.63},{market:'Philadelphia',rank:4,hh:2940000,state:'PA',lat:39.95,lon:-75.17},
{market:'Dallas-Fort Worth',rank:5,hh:2870000,state:'TX',lat:32.78,lon:-96.80},{market:'San Francisco-Oakland',rank:6,hh:2600000,state:'CA',lat:37.77,lon:-122.42},
{market:'Washington DC',rank:7,hh:2500000,state:'DC',lat:38.91,lon:-77.04},{market:'Houston',rank:8,hh:2490000,state:'TX',lat:29.76,lon:-95.37},
{market:'Atlanta',rank:10,hh:2460000,state:'GA',lat:33.75,lon:-84.39},{market:'Seattle-Tacoma',rank:12,hh:2000000,state:'WA',lat:47.61,lon:-122.33},
{market:'Phoenix',rank:13,hh:1980000,state:'AZ',lat:33.45,lon:-112.07},{market:'Detroit',rank:14,hh:1890000,state:'MI',lat:42.33,lon:-83.05},
{market:'Minneapolis-St. Paul',rank:15,hh:1860000,state:'MN',lat:44.98,lon:-93.27},{market:'Denver',rank:16,hh:1770000,state:'CO',lat:39.74,lon:-104.99},
{market:'Miami-Fort Lauderdale',rank:17,hh:1710000,state:'FL',lat:25.76,lon:-80.19},{market:'Cleveland',rank:19,hh:1510000,state:'OH',lat:41.50,lon:-81.69},
{market:'Portland OR',rank:21,hh:1240000,state:'OR',lat:45.52,lon:-122.68},{market:'Charlotte',rank:23,hh:1200000,state:'NC',lat:35.23,lon:-80.84},
{market:'Nashville',rank:29,hh:1070000,state:'TN',lat:36.16,lon:-86.78},{market:'Salt Lake City',rank:32,hh:960000,state:'UT',lat:40.76,lon:-111.89}
];
const uncoveredDMAs=topDMAs.filter(d=>!coveredMarkets.has(d.market)).sort((a,b)=>a.rank-b.rank);
const uncoveredHH=uncoveredDMAs.reduce((s,d)=>s+d.hh,0);
const coveredRegions={};stations.forEach(s=>{if(!coveredRegions[s.region])coveredRegions[s.region]={count:0};coveredRegions[s.region].count++});
const regionNets={};stations.forEach(s=>{if(!regionNets[s.region])regionNets[s.region]=new Set();regionNets[s.region].add(s.network)});
const allNets=['ABC','NBC','CBS','CW+','IND'];

document.getElementById('gaps-summary').innerHTML=`
<div class="gap-card"><h4>Uncovered States</h4><div class="gap-stat">${missingStates.length} / ${allStates.length}</div><p>${missingStates.length?missingStates.join(', '):'Full coverage!'}</p></div>
<div class="gap-card"><h4>Top 20 DMA Gaps</h4><div class="gap-stat">${uncoveredDMAs.length} markets</div><p>${(uncoveredHH/1e6).toFixed(1)}M unreached HH</p></div>
<div class="gap-card"><h4>Regional Balance</h4><div class="gap-stat">${Object.keys(coveredRegions).length} regions</div><p>${Object.entries(coveredRegions).map(([r,d])=>r+': '+d.count).join(' Â· ')}</p></div>
<div class="gap-card"><h4>Network Gaps by Region</h4><div class="gap-stat">â€”</div><p>${Object.entries(regionNets).map(([r,nets])=>{const m=allNets.filter(n=>!nets.has(n));return m.length?r+': no '+m.join(', '):r+': all'}).join(' Â· ')}</p></div>`;

// Gaps map
const gapMapC=document.getElementById('gaps-map-container');
const gapTT=document.getElementById('gaps-tooltip');
let gSVG=`<svg viewBox="0 0 ${W} ${H}" xmlns="http://www.w3.org/2000/svg"><rect width="${W}" height="${H}" fill="transparent"/>`;
stations.forEach(s=>{const[x,y]=proj(s.lat,s.lon);gSVG+=`<circle cx="${x}" cy="${y}" r="4" fill="${netColors[s.network]||'#888'}" opacity=".25"/>`;});
uncoveredDMAs.forEach((d,i)=>{const[x,y]=proj(d.lat,d.lon);gSVG+=`<circle class="gap-dot" cx="${x}" cy="${y}" r="${Math.max(5,Math.min(12,d.hh/500000))}" fill="var(--amber)" opacity=".7" data-gi="${i}"><animate attributeName="opacity" values=".4;.8;.4" dur="2s" repeatCount="indefinite"/></circle>`;});
gSVG+=`</svg>`;gapMapC.innerHTML=gSVG;
gapMapC.addEventListener('mouseover',e=>{if(e.target.classList.contains('gap-dot')){const d=uncoveredDMAs[e.target.dataset.gi];gapTT.innerHTML=`<strong>${d.market}, ${d.state}</strong><br>DMA #${d.rank} Â· ${(d.hh/1e6).toFixed(2)}M HH<br><em>Not in portfolio</em>`;gapTT.classList.add('show');const r=gapMapC.getBoundingClientRect();gapTT.style.left=(e.clientX-r.left+12)+'px';gapTT.style.top=(e.clientY-r.top-10)+'px'}});
gapMapC.addEventListener('mouseout',e=>{if(e.target.classList.contains('gap-dot'))gapTT.classList.remove('show')});
gapMapC.addEventListener('mousemove',e=>{if(gapTT.classList.contains('show')){const r=gapMapC.getBoundingClientRect();gapTT.style.left=(e.clientX-r.left+12)+'px';gapTT.style.top=(e.clientY-r.top-10)+'px'}});
})();

// 3. Expansion Opportunities
(function renderExpansion(){
const coveredMarkets=new Set(stations.map(s=>s.market));
const coveredRegionCount={};stations.forEach(s=>{coveredRegionCount[s.region]=(coveredRegionCount[s.region]||0)+1});
const topDMAs=[
{market:'New York',rank:1,hh:7400000,state:'NY',region:'Northeast'},{market:'Los Angeles',rank:2,hh:5700000,state:'CA',region:'West'},
{market:'Chicago',rank:3,hh:3470000,state:'IL',region:'Midwest'},{market:'Philadelphia',rank:4,hh:2940000,state:'PA',region:'Northeast'},
{market:'Dallas-Fort Worth',rank:5,hh:2870000,state:'TX',region:'South'},{market:'San Francisco-Oakland',rank:6,hh:2600000,state:'CA',region:'West'},
{market:'Washington DC',rank:7,hh:2500000,state:'DC',region:'Northeast'},{market:'Houston',rank:8,hh:2490000,state:'TX',region:'South'},
{market:'Atlanta',rank:10,hh:2460000,state:'GA',region:'Southeast'},{market:'Seattle-Tacoma',rank:12,hh:2000000,state:'WA',region:'West'},
{market:'Phoenix',rank:13,hh:1980000,state:'AZ',region:'West'},{market:'Detroit',rank:14,hh:1890000,state:'MI',region:'Midwest'},
{market:'Minneapolis-St. Paul',rank:15,hh:1860000,state:'MN',region:'Midwest'},{market:'Denver',rank:16,hh:1770000,state:'CO',region:'West'},
{market:'Miami-Fort Lauderdale',rank:17,hh:1710000,state:'FL',region:'Southeast'},{market:'Cleveland',rank:19,hh:1510000,state:'OH',region:'Midwest'},
{market:'Portland OR',rank:21,hh:1240000,state:'OR',region:'West'},{market:'Charlotte',rank:23,hh:1200000,state:'NC',region:'Southeast'},
{market:'Nashville',rank:29,hh:1070000,state:'TN',region:'Southeast'},{market:'Salt Lake City',rank:32,hh:960000,state:'UT',region:'West'}
];
const uncovered=topDMAs.filter(d=>!coveredMarkets.has(d.market));
uncovered.forEach(d=>{
const rp=coveredRegionCount[d.region]||0;
d.score=Math.min(40,Math.round(d.hh/200000))+Math.max(0,30-d.rank)+(rp>0?15:0)+(rp<3?10:0);
d.reasons=[];
if(d.rank<=10)d.reasons.push('Top 10 DMA â€” premium market');
if(rp>0)d.reasons.push('Synergy with '+rp+' existing '+d.region+' station'+(rp>1?'s':''));
if(rp===0)d.reasons.push('Opens new region: '+d.region);
if(d.hh>=2000000)d.reasons.push('2M+ household reach');
if(rp<3)d.reasons.push('Improves regional diversity');
});
uncovered.sort((a,b)=>b.score-a.score);
document.getElementById('expansion-list').innerHTML=uncovered.map(d=>`<div class="expansion-card"><div class="exp-score">Score: ${d.score}</div><h4>${d.market}, ${d.state}</h4><div class="exp-rank">DMA #${d.rank} Â· ${d.region}</div><div class="exp-hh">${(d.hh/1e6).toFixed(2)}M HH</div><div class="exp-reason">${d.reasons.map(r=>'â€¢ '+r).join('<br>')}</div></div>`).join('');
})();
</script>
</body>
</html>
